(function(e){"use strict";function t(e,t){this.values=t||{};this.configure(e);this.__init();var n=this;return this}t.defaults={timeAfterWriting:250,field:{fieldWrapper:{tag:"p",atributes:null}},form:{method:"POST",action:"#"}};t.prototype.__init=function(){this.fields=[];this.Field().__init()};t.prototype.configure=function(e){var n=t.defaults;n.merge.merge(e);this.options=n};t.defaultsFields={input:document.createElement("input"),textarea:document.createElement("textarea"),button:document.createElement("button"),label:document.createElement("LABEL")};t.editDefaultField=function(e,n,r){if(typeof e=="string"){t.defaultsFields[e]=t.defaultsFields[e].setAttributes(n)}else{r=n;n=e;e=null;for(var i in t.defaultsFields)if(t.defaultsFields.hasOwnProperty(i)&&r!=undefined&&(typeof r=="string"&&i==r||r.indexOf(i)>=0))t.defaultsFields[i]=t.defaultsFields[i].setAttributes(n)}};t.getField=function(e){return t.defaultsFields[e].cloneNode(true)};t.prototype.Field=function(){this.__init=function(){this.setFieldWrapper(this.options.field.fieldWrapper.tag,this.options.field.fieldWrapper.attributes)};this.selected={form:this,node:null};this.field=function(e,n){var r=t.getField(e);if(typeof n=="string"||typeof n=="undefined"){r.setAttribute("name",n)}else if(typeof n=="object"){r.setAttributes(n)}this.selected.node=r;return this.addElement(r)};this.addElement=function(e,t){if(typeof t!="undefined"){var n=this.fields.indexOf(e);this.fields.splice(n,0,t)}else{this.fields.push(e)}return e};this.input=function(e){var t=this.field("input",e);return this.selected};this.textarea=function(e){var t=this.field("textarea",e);return this.selected};this.button=function(e){var t=this.field("button",e);t.type="submit";return this.selected};this.label=function(e,n){var r=t.getField("label");r.innerHTML=e;r.setAttribute("for",n.id);return this.addElement(n,r)};this.selected.labelIt=function(e){this.node.id="fb"+e.toUpperCase().replace(/[^\w\s ]/gi,"").replace(/ /g,"").substr(0,8);this.form.label(e,this.node)};this.selected.on=function(e,t){this.form.Event().addEvent(this.node,e,t);return this};return this};t.prototype.Form=function(){this.configure=function(e){this.options.form=this.options.form.merge(e)};this.get=function(){var e=document.createElement("form");e.setAttributes(this.options.form);var t=this;e.onsubmit=function(e){t.onSubmit(e,t.fields.filter(function(e){return e.name}).map(function(e){var t={field:e,value:e.value=="undefined"?"":e.value,name:e.name};return t}));if(t.preventDefault===true)e.preventDefault();return!t.preventDefault};return e};return this};t.prototype.Validator=function(){return this};t.prototype.Event=function(){this.timer=null;this.events=["writing","afterwriting","keypress","keydown","keyup","focus","blur","click","dblclick"];this.addEvent=function(e,t,n){if(this.events.indexOf(t)>=0){if(typeof e["on"+t]=="undefined"){switch(t){case"writing":this.addEvent(e,"keyup",n);break;case"afterwriting":var r=this;e.onkeyup=function(t){clearTimeout(r.timer);r.timer=setTimeout(function(){n(e.value,t)},r.options.timeAfterWriting)};break;default:throw new Error("Event type isn't implemented")}}else{e.addEventListener(t,function(t){n(e.value,t)},false)}}else{throw new Error("The "+t+" event is unknow.")}};return this};t.prototype.setWrapper=function(e){var t=document.querySelector(e);if(t!=null)this.wrapper=t;else throw new Error("Wrapper isn't found")};t.prototype.setFieldWrapper=function(e,t){var n=document.createElement(e);if(typeof t=="object")n.setAttributes(t);this.fieldWrap=n};t.prototype.setOnSubmit=function(e,t){this.onSubmit=e;this.preventDefault=t};t.prototype.render=function(){if(!this.wrapper)throw new Error("Wrapper must be defined.");var e=this.Form().get();for(var t in this.fields){if(this.fields.hasOwnProperty(t)){var n=this.fields[t];if(n.name&&this.values[n.name]!=undefined){n.setAttribute("value",this.values[n.name])}var r=n;if(typeof this.fieldWrap!="undefined"){r=this.fieldWrap.cloneNode();r.appendChild(n)}e.appendChild(r)}}this.wrapper.appendChild(e)};Object.prototype.setAttributes=function(e){for(var t in e){if(e.hasOwnProperty(t)){if(t=="innerContent")this.innerHTML=e[t];else if(t=="class")this.setAttribute(t,[this.className,e[t]].join(" ").trim());else this.setAttribute(t,e[t])}}return this};Object.prototype.merge=function(e){if(typeof e=="object"){for(var t in e){try{if(e[t].constructor==Object)this[t]=this[t].merge(e[t]);else this[t]=e[t]}catch(n){this[t]=e[t]}}}return this};e.FormBuilder=t})(this)
