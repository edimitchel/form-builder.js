(function(e){"use strict";function t(e,t){this.values=t||{};this.configure(e);this.__init();return this}t.defaults={timeAfterWriting:250,validateForm:true,prefixGeneratedId:"fb",maxLengthGeneratedId:10,createId:function(e){var t=e.toLowerCase().replace(/[^\w\s ]/gi,"").replace(/ /g,"");return(this.prefixGeneratedId+t.charAt(0).toUpperCase()+t.substr(1)).substr(0,this.maxLengthGeneratedId)},field:{fieldWrapper:{tag:"p",atributes:null}},form:{method:"POST",action:"#"}};t.prototype.__init=function(){this.fields=[];this.Field().__init()};t.prototype.configure=function(e){var n=t.defaults;n.merge.merge(e);this.options=n};t.defaultsFields={input:document.createElement("INPUT"),textarea:document.createElement("TEXTAREA"),button:document.createElement("BUTTON"),label:document.createElement("LABEL"),select:document.createElement("SELECT"),option:document.createElement("OPTION")};t.editDefaultField=function(e,n){if(typeof e=="string"){t.defaultsFields[e]=t.defaultsFields[e].setAttributes(n)}else{var r=n;n=e;e=r;for(var i in t.defaultsFields)if(t.defaultsFields.hasOwnProperty(i)&&e!=undefined&&(typeof e=="string"&&i==e||e.indexOf(i)>=0))t.defaultsFields[i]=t.defaultsFields[i].setAttributes(n)}};t.getField=function(e){if(t.defaultsFields[e]!=undefined){return t.defaultsFields[e].cloneNode(true)}throw new Error("The field "+e+" isn't know.")};t.prototype.Field=function(){this.__init=function(){this.setFieldWrapper(this.options.field.fieldWrapper.tag,this.options.field.fieldWrapper.attributes)};this.selected={form:this,node:null};this.field=function(e,n,r){var i=t.getField(e);if(n!=null){if(typeof n=="string"||typeof n=="undefined"){t.setAttribute(i,"name",n)}else if(typeof n=="object"){i.setAttributes(n);if(n.hasOwnProperty("childrens")){for(var s=0;s<n.childrens.length;s++)i.appendChild(n.childrens[s])}}}this.selected.node=i;return r==undefined||r==true?this.addElement(i):i};this.updateField=function(e,t){if(this.fields[this.indexOf(e)].isArray()){return this.fields[this.indexOf(e)].filter(function(e){return e.name})[0]}else{if(typeof t=="object"){this.fields[this.indexOf(e)].setAttributes(t);if(t.hasOwnProperty("childrens"))for(var n=0;n<t.childrens.length;n++)this.fields[this.indexOf(e)].appendChild(t.childrens[n])}return this.fields[this.indexOf(e)]}};this.indexOf=function(e){for(var t=0;t<this.fields.length;t++){var n=this.fields[t];if(n.isArray()){n=n.filter(function(e){return e.name})[0]}if(n.name==e)return t}return-1};this.addElement=function(e,t){if(typeof t!="undefined"){var n=this.fields.indexOf(e);this.fields[n]=[t,this.fields[n]]}else{var r=this;e.check=function(){return r.check(this)};this.fields.push(e)}return e};this.input=function(e,t){var n;if(e!=undefined){if(typeof t=="string"){t={name:t,type:e}}else if(typeof t=="object"){t.type=e}}n=this.field("input",t);return this.selected};this.textarea=function(e){var t=this.field("textarea",e);return this.selected};this.select=function(e,t){var n=[];for(var r in t){if(t.hasOwnProperty(r)){n.push(this.option(r,t[r]).node)}}if(e.isString()){e={name:e}}e.childrens=n;var i=this.field("select",e);return this.selected};this.option=function(e,t){var n=this.field("option",{innerHTML:t,value:e},false);return this.selected};this.checkbox=function(e,t){var n=this.input("checkbox",{value:t,name:e});return this.selected};this.radio=function(e,t){var n=this.input("radio",{value:t,name:e});return this.selected};this.button=function(e,n){var r=this.field("button",n);t.setAttribute(r,"innerHTML",e);return this.selected};this.label=function(e,n){var r=t.getField("label");t.setAttribute(r,"innerHTML",e);t.setAttribute(r,"for",n.id);return this.addElement(n,r)};this.selected.labelIt=function(e){this.node.id=this.form.options.createId(e);this.form.label(e,this.node);return this};this.selected.selectValue=function(e){if(arguments.length>1){var t=[];for(var n=0;n<arguments.length;n++){t.push(arguments[n])}var r=[].slice.call(this.node.children);while(this.node.firstChild!=null)this.node.removeChild(this.node.firstChild);for(n=0;n<r.length;n++){if(t.indexOf(r[n].value)>=0)r[n].selected="selected";this.node.appendChild(r[n])}}else{var i=[].slice.call(this.node.children).map(function(e){return e.value}).indexOf(e);this.form.updateField(this.node.name,null).children[i].selected="selected"}};this.selected.on=function(e,t){this.form.Event().addEvent(this.node,e,t);return this};this.check=function(e){var t={valid:null,message:null};switch(e.nodeName){case"INPUT":case"TEXTAREA":if(e.pattern!=undefined&&e.pattern!=null){return(new RegExp(e.pattern)).test(e.value)}break;case"OPTION":break}return t};return this};t.prototype.Form=function(){this.configure=function(e){this.options.form=this.options.form.merge(e)};this.get=function(){var e=document.createElement("form");e.setAttributes(this.options.form);var t=this;e.onsubmit=function(e){var n=function(e){return e.name||e.isArray()};var r=function(e){if(e.isArray()){e=e.filter(function(e){return e.name})[0]}var t=e.value=="undefined"?"":e.value;if(t!=""&&e.nodeName.toLowerCase()=="select"){t=[].slice.call(e.selectedOptions).map(function(e){return e.value})}return{field:e,value:t,name:e.name}};t.onSubmit(e,t.fields.filter(n).map(r));if(t.options.validateForm){t.Validator().process()}if(t.preventDefault===true)e.preventDefault();return!t.preventDefault};return e};return this};t.prototype.Validator=function(){this.valid=true;this.errors=[];this.process=function(){var e=true;var t=function(e){return e.check&&e.nodeName!="BUTTON"};for(var n=0;n<this.fields.filter(t).length;n++){var r=this.fields.filter(t)[n].check();console.log(this.fields.filter(t)[n].check());if(!r.valid){this.valid=false;this.errors.push({field:this.fields[n],message:r.message})}}this.valid=e};return this};t.prototype.Event=function(){this.timer=null;this.events=["writing","afterwriting","keypress","keydown","keyup","focus","blur","click","dblclick"];this.addEvent=function(e,t,n){if(this.events.indexOf(t)>=0){if(typeof e["on"+t]=="undefined"){switch(t){case"writing":this.addEvent(e,"keyup",n);break;case"afterwriting":var r=this;e.onkeyup=function(t){clearTimeout(r.timer);r.timer=setTimeout(function(){n(e.value,t)},r.options.timeAfterWriting)};break;default:throw new Error("Event type isn't implemented")}}else{e.addEventListener(t,function(t){n(e.value,t)},false)}}else{throw new Error("The "+t+" event is unknow.")}};return this};t.prototype.setWrapper=function(e){var t=document.querySelector(e);if(t!=null)this.wrapper=t;else throw new Error("Wrapper isn't found")};t.prototype.setFieldWrapper=function(e,t){var n=document.createElement(e);if(typeof t=="object")n.setAttributes(t);this.fieldWrap=n};t.prototype.setOnSubmit=function(e,t){this.onSubmit=e;this.preventDefault=t};t.prototype.render=function(){if(!this.wrapper)throw new Error("Wrapper must be defined.");var e=this.Form().get();t.renderFields(this,this.fields,e);this.wrapper.appendChild(e)};t.renderFields=function(e,n,r,i){i=i==undefined?true:i;for(var s=0;s<n.length;s++){var o;if(n[s]!="undefined"){if(e.fieldWrap!=undefined){if(i){o=e.fieldWrap.cloneNode()}}if(!n[s].isArray()){var u=n[s];if(u.name&&e.values[u.name]!=undefined)u.setAttribute("value",e.values[u.name]);if(i)o.appendChild(u);else o=u}else{t.renderFields(e,n[s],o,false)}}r.appendChild(o)}};Object.prototype.setAttributes=function(e){for(var n in e){if(e.hasOwnProperty(n)){t.setAttribute(this,n,e[n])}}return this};t.setAttribute=function(e,t,n){if(n!=undefined){if(t=="innerHTML")e.innerHTML=n;else if(t=="childrens")e.childrens=n;else if(t=="class")e.setAttribute(t,[e.className,n].join(" ").trim());else e.setAttribute(t,n)}return e};Object.prototype.merge=function(e){if(typeof e=="object"){for(var t in e){try{if(e[t].constructor==Object)this[t]=this[t].merge(e[t]);else this[t]=e[t]}catch(n){this[t]=e[t]}}}return this};Object.prototype.isArray=function(){return Object.prototype.toString.call(this).indexOf("Array")>=0};Object.prototype.isString=function(){return typeof this=="string"};e.FormBuilder=t})(window)